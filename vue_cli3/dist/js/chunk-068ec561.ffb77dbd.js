(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-068ec561"],{"094a":function(e,t,a){"use strict";var i=a("61ad"),n=a.n(i);n.a},"2bbb":function(e,t,a){"use strict";a.r(t);var i=a("3028"),n=a.n(i);for(var r in i)"default"!==r&&function(e){a.d(t,e,(function(){return i[e]}))}(r);t["default"]=n.a},3028:function(e,t,a){"use strict";var i=a("2eb1");a("7ae7"),a("c354"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("63ff");var n=i(a("57f0"));a("44ce");var r=i(a("6bf2")),s=i(a("e81a")),o=i(a("a83b")),c=i(a("a5a1")),l=a("f946"),d=a("7223"),u=i(a("decd")),f=u.default.setConfirmSign;window.mOxie=window.moxie=a("c079"),a("9f56");var m={name:"user-sign",data:function(){return{transTime:"",bigImgBase:"",bigImgUrl:"",loading:!1,signUrl:"",serviceImg:"",hasContent:!1,signs:{},client:{},points:[],canvas:"",canvasTxt:null,startX:0,startY:0,moveY:0,moveX:0,endY:0,endX:0}},mounted:function(){var e=this;this.$nextTick((function(){e.serviceImg=o.default.getStorage("affirm").oData,e.initAllPlupload(),e.uploadSign(),e.initPlupload(),e.canvas=e.$refs.canvasF,e.canvas.height=e.$refs.canvasHW.offsetHeight-2,e.canvas.width=e.$refs.canvasHW.offsetWidth-60,e.canvasTxt=e.canvas.getContext("2d"),e.canvasTxt.lineWidth=3,e.canvasTxt.fillStyle="#fff",e.canvasTxt.fillRect(0,0,e.canvas.width,e.canvas.height)}))},methods:{initAllPlupload:function(){var e=this,t="3mb";function a(t,a,i){var n="";a&&"string"==typeof a&&(n=d.commonFun.trimAll(a));var s=e.signs.dir+(0,r.default)().format("X")+d.commonFun.random_string(6)+n,o={key:s,policy:e.signs.policy,OSSAccessKeyId:e.signs.accessid,success_action_status:200,signature:e.signs.signature};return t.setOption({url:e.signs.host,multipart_params:o}),t.start(),s}e.uploaderSec=new plupload.Uploader({multi_selection:!0,browse_button:"uploadBigImg",url:e.signs.host,flash_swf_url:"../../../../static/lib/uploads/moxie.swf",filters:{max_file_size:t,prevent_duplicates:!0},init:{PostInit:function(){document.getElementById("baseSec").onclick=function(){var t=d.commonFun.base64ToBlob(e.bigImgBase);e.uploaderSec.addFile(t,""),a(e.uploaderSec,"",!1)}},FilesAdded:function(t,i){a(e.uploaderSec,"",!1)},FileUploaded:function(e,t,a){200===a.status||(203===a.status?alert("上传到OSS成功，但是oss访问用户设置的上传回调服务器失败，失败原因是:"+a.response):(alert("imgError"),alert(JSON.stringify(a.response))))},BeforeUpload:function(t,i){e.upFile=a(t,i.name,!0)},UploadComplete:function(t,a){e.loading=!1,e.bigImgUrl="".concat(e.signs.host,"/").concat(e.upFile),e.downloadFile("签名",e.bigImgUrl),e.$router.push({path:"serviceVoucherList"})},Error:function(t,a){-600===a.code||-601===a.code||(-602===a.code?e.errorMsg="已上传过":alert(JSON.stringify(a))),e.loading=!1}}}),e.uploaderSec.init()},downloadFile:function(e,t){var a=document.createElement("a"),i=document.createEvent("HTMLEvents");i.initEvent("click",!0,!0),a.download=e,a.href=t,a.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window}))},signSuccess:function(){var e=this,t=document.querySelector(".service-affirm"),a=t.cloneNode(!0);a.className+=" voucher-user-sign-copy-dom",a.style.position="absolute",a.style.backgroundColor="white",a.style.zIndex="-3",document.body.appendChild(a),window.pageYOffset=0,document.documentElement.scrollTop=0,document.body.scrollTop=0,(0,s.default)(document.querySelector(".voucher-user-sign-copy-dom")).then((function(t){e.bigImgBase=t.toDataURL("image/png");var i=document.querySelector(".affirm-base");document.querySelector(".sign-wrap").removeChild(i),document.body.removeChild(a);var n=document.getElementById("baseSec"),r=new MouseEvent("click");n.dispatchEvent(r)}))},addConfirmSign:function(e){return(0,n.default)(regeneratorRuntime.mark((function t(){var a,i,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,a={url:e},t.next=4,f(a);case 4:i=t.sent,n=i.data,0===n.code&&console.log(n),t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](0),console.log(t.t0);case 12:case"end":return t.stop()}}),t,null,[[0,9]])})))()},touchStart:function(e){if(e=e||event,e.preventDefault(),1==e.touches.length){var t={x:e.targetTouches[0].clienX,y:e.targetTouches[0].clientY};this.startX=t.x,this.startY=t.y,this.canvasTxt.beginPath(),this.canvasTxt.moveTo(this.startX,this.startY),this.canvasTxt.lineTo(t.x,t.y),this.canvasTxt.stroke(),this.canvasTxt.closePath(),this.points.push(t)}},touchMove:function(e){if(e=e||event,e.preventDefault(),1==e.touches.length){var t={x:e.targetTouches[0].clientX,y:e.targetTouches[0].clientY};this.moveY=t.y,this.moveX=t.x,this.canvasTxt.beginPath(),this.canvasTxt.moveTo(this.startX,this.startY),this.canvasTxt.lineTo(t.x,t.y),this.canvasTxt.stroke(),this.canvasTxt.closePath(),this.startY=t.y,this.startX=t.x,this.points.push(t)}this.hasContent||(this.hasContent=!0)},touchEnd:function(e){if(e=e||event,e.preventDefault(),1==e.touches.length){var t={x:e.targetTouches[0].clientX,y:e.targetTouches[0].clientY};this.canvasTxt.beginPath(),this.canvasTxt.moveTo(this.startX,this.startY),this.canvasTxt.lineTo(t.x,t.y),this.canvasTxt.stroke(),this.canvasTxt.closePath(),this.points.push(t)}},overwrite:function(){this.canvasTxt.clearRect(0,0,this.$refs.canvasF.width,this.$refs.canvasF.height),this.points=[],this.hasContent=!1},initPlupload:function(){var e=this,t="100mb";function a(t,a,i){var n="";a&&"string"==typeof a&&(n=d.commonFun.trimAll(a));var s=e.signs.dir+(0,r.default)().format("X")+d.commonFun.random_string(6)+n,o={key:s,policy:e.signs.policy,OSSAccessKeyId:e.signs.accessid,success_action_status:200,signature:e.signs.signature};return t.setOption({url:e.signs.host,multipart_params:o}),t.start(),s}e.uploader=new plupload.Uploader({multi_selection:!0,browse_button:"uploadImg",url:e.signs.host,flash_swf_url:"../../../../static/lib/uploads/moxie.swf",filters:{max_file_size:t,prevent_duplicates:!0},init:{PostInit:function(){document.getElementById("upload").onclick=function(){var t=e.$refs.canvasRotate;t.height=e.$refs.canvasHW.offsetWidth-60,t.width=e.$refs.canvasHW.offsetHeight-2;var i=e.$refs.canvasRotate.getContext("2d");i.fillStyle="#fff";var n=new Image;n.src=e.$refs.canvasF.toDataURL("image/png"),e.signUrl=e.$refs.canvasF.toDataURL("image/png"),n.onload=function(t){var r=(e.$refs.canvasHW.offsetHeight-40)/2;e.$refs.canvasHW.offsetWidth;i.translate(0,r),i.rotate(-90*Math.PI/180),i.drawImage(n,0,0);var s=d.commonFun.base64ToBlob(e.$refs.canvasRotate.toDataURL("image/png"));e.uploader.addFile(s,""),a(e.uploader,"",!1),e.loading=!0}}},FilesAdded:function(t,i){a(e.uploader,"",!1)},FileUploaded:function(e,t,a){200===a.status||(203===a.status?alert("上传到OSS成功，但是oss访问用户设置的上传回调服务器失败，失败原因是:"+a.response):(alert("imgError"),alert(JSON.stringify(a.response))))},BeforeUpload:function(t,i){e.upFile=a(t,i.name,!0)},UploadComplete:function(t,a){var i=new Image;i.src=e.signUrl,i.onload=function(){e.signSuccess()},e.addConfirmSign("/".concat(e.upFile))},Error:function(t,a){-600===a.code||-601===a.code||(-602===a.code?e.errorMsg="已上传过":alert(JSON.stringify(a))),e.loading=!1}}}),e.uploader.init()},uploadSign:function(){var e=this;return(0,n.default)(regeneratorRuntime.mark((function t(){var a,i,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,a={cate:"order_service_confirm"},t.next=4,(0,l.getSign)(a);case 4:i=t.sent,n=i.data,0===n.code&&(e.signs=n.data,e.transTime=c.default.filterDate((new Date).getTime(),"YYYY年MM月DD日")),t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](0),console.log(t.t0);case 12:case"end":return t.stop()}}),t,null,[[0,9]])})))()}}};t.default=m},"44ce":function(e,t){(function(e,t){var a,i=e.document,n=i.documentElement,r=i.querySelector('meta[name="viewport"]'),s=i.querySelector('meta[name="flexible"]'),o=0,c=0,l=t.flexible||(t.flexible={});if(r){console.warn("将根据已有的meta标签来设置缩放比例");var d=r.getAttribute("content").match(/initial\-scale=([\d\.]+)/);d&&(c=parseFloat(d[1]),o=parseInt(1/c))}else if(s){var u=s.getAttribute("content");if(u){var f=u.match(/initial\-dpr=([\d\.]+)/),m=u.match(/maximum\-dpr=([\d\.]+)/);f&&(o=parseFloat(f[1]),c=parseFloat((1/o).toFixed(2))),m&&(o=parseFloat(m[1]),c=parseFloat((1/o).toFixed(2)))}}if(!o&&!c){e.navigator.appVersion.match(/android/gi);var v=e.navigator.appVersion.match(/iphone/gi),g=e.devicePixelRatio;o=v?g>=3&&(!o||o>=3)?3:g>=2&&(!o||o>=2)?2:1:1,c=1/o}if(n.setAttribute("data-dpr",o),!r)if(r=i.createElement("meta"),r.setAttribute("name","viewport"),r.setAttribute("content","initial-scale="+c+", maximum-scale="+c+", minimum-scale="+c+", user-scalable=no"),n.firstElementChild)n.firstElementChild.appendChild(r);else{var p=i.createElement("div");p.appendChild(r),i.write(p.innerHTML)}function h(){var t=n.getBoundingClientRect().width;t/o>540&&(t=540*o);var a=t/10;n.style.fontSize=a+"px",l.rem=e.rem=a}e.addEventListener("resize",(function(){clearTimeout(a),a=setTimeout(h,300)}),!1),e.addEventListener("pageshow",(function(e){e.persisted&&(clearTimeout(a),a=setTimeout(h,300))}),!1),"complete"===i.readyState?i.body.style.fontSize=12*o+"px":i.addEventListener("DOMContentLoaded",(function(e){i.body.style.fontSize=12*o+"px"}),!1),h(),l.dpr=e.dpr=o,l.refreshRem=h,l.rem2px=function(e){var t=parseFloat(e)*this.rem;return"string"===typeof e&&e.match(/rem$/)&&(t+="px"),t},l.px2rem=function(e){var t=parseFloat(e)/this.rem;return"string"===typeof e&&e.match(/px$/)&&(t+="rem"),t}})(window,window["lib"]||(window["lib"]={}))},"61ad":function(e,t,a){var i=a("9888");"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var n=a("85cb").default;n("6c918677",i,!0,{sourceMap:!1,shadowMode:!1})},"744e":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"sign-wrap",attrs:{"element-loading-text":"生成图片中，长按图片保存"}},[a("div",{staticClass:"service-affirm affirm-base"},[a("div",{staticClass:"title"},[e._v(" 居理新房服务确认单 ")]),a("img",{attrs:{src:e.serviceImg}}),a("div",{staticClass:"user-name"},[a("span",[e._v("用户签名：")]),a("img",{attrs:{src:e.signUrl,alt:"用户签名"}})]),a("div",{staticClass:"sign-time"},[e._v(" 签字时间："+e._s(e.transTime)+" ")])]),a("canvas",{ref:"canvasRotate",staticClass:"canvas-rotate"}),a("div",{attrs:{id:"uploadImg"}}),a("div",{attrs:{id:"uploadBigImg"}}),a("div",{attrs:{id:"baseSec"}}),a("div",{ref:"signatureContainer",staticClass:"signature"},[a("div",{staticClass:"signatureBox"},[a("div",{ref:"canvasHW",staticClass:"canvasBox"},[a("canvas",{ref:"canvasF",on:{touchstart:e.touchStart,touchmove:e.touchMove,touchend:e.touchEnd}})])]),a("div",{class:"btnBox "+(e.hasContent?"":"disable-btn")},[a("div",{staticClass:"success",attrs:{id:"upload"}},[e._v("完成")]),a("div",{staticClass:"reset",on:{click:e.overwrite}},[e._v(" 清除内容 ")])])])])},n=[];a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return n}))},"7e9c":function(e,t,a){"use strict";a.r(t);var i=a("744e"),n=a("2bbb");for(var r in n)"default"!==r&&function(e){a.d(t,e,(function(){return n[e]}))}(r);a("e246"),a("094a");var s=a("5511"),o=Object(s["a"])(n["default"],i["a"],i["b"],!1,null,"008013b0",null);t["default"]=o.exports},8345:function(e,t,a){var i=a("f61d");"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var n=a("85cb").default;n("37b12391",i,!0,{sourceMap:!1,shadowMode:!1})},9888:function(e,t,a){var i=a("abd8");t=i(!1),t.push([e.i,".sign-wrap[data-v-008013b0]{position:relative;height:100%;overflow:hidden;background-color:#fff}.sign-wrap .service-affirm[data-v-008013b0]{position:absolute;font-size:.48rem;text-align:center;visibility:hidden}.sign-wrap .service-affirm .title[data-v-008013b0]{margin:.4rem 0}.sign-wrap .service-affirm>img[data-v-008013b0]{width:100%}.sign-wrap .service-affirm .user-name[data-v-008013b0]{overflow:hidden;padding:0 .533333rem;background-color:#fff}.sign-wrap .service-affirm .user-name>span[data-v-008013b0]{font-size:.373333rem;float:left;line-height:1.253333rem}.sign-wrap .service-affirm .user-name>img[data-v-008013b0]{float:left;width:2.666667rem}.sign-wrap .service-affirm .sign-time[data-v-008013b0]{padding:0 .533333rem .533333rem;height:1.066667rem;line-height:.533333rem;font-size:.373333rem;text-align:right;background-color:#fff}.imgs2[data-v-008013b0]{width:238px;position:relative;left:100px;bottom:10px;height:50px}#baseSec[data-v-008013b0],#uploadBigImg[data-v-008013b0],#uploadImg[data-v-008013b0],.canvas-rotate[data-v-008013b0]{display:none}.signature[data-v-008013b0]{position:absolute;height:100%;width:100%}.signature .btnBox[data-v-008013b0]{-webkit-transform:rotate(90deg);transform:rotate(90deg);position:absolute;bottom:2.133333rem;right:-.933333rem;font-size:.426667rem}.signature .reset[data-v-008013b0]{float:right;color:#33a1ff;height:.88rem;line-height:.88rem;margin-right:.933333rem}.signature .success[data-v-008013b0]{float:right;color:#fff;background-color:#33a1ff;padding:5px .266667rem;border-radius:3px}.signature .disable-btn .reset[data-v-008013b0],.signature .disable-btn .success[data-v-008013b0]{pointer-events:none}.signature .disable-btn .reset[data-v-008013b0]{color:#bcc0c4}.signature .disable-btn .success[data-v-008013b0]{background-color:#bcc0c4}.signatureBox[data-v-008013b0]{width:100%;height:100%;overflow:hidden;background:#fff;z-index:100;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.canvasBox[data-v-008013b0],.signatureBox[data-v-008013b0]{-webkit-box-sizing:border-box;box-sizing:border-box}.canvasBox[data-v-008013b0]{-webkit-box-flex:1;-ms-flex:1;flex:1}.btnBox[data-v-008013b0]{text-align:center}",""]),e.exports=t},a5a1:function(e,t,a){"use strict";var i=a("2eb1");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(a("6bf2")),r={filterDate:function(e,t){var a=parseInt(e);return(0,n.default)(a).format(t)}};t.default=r},a83b:function(e,t,a){"use strict";a("b128"),a("b3f9"),a("7267"),a("ec4a"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i={setStorage:function(e,t){var a={createTime:(new Date).getTime(),oData:t},i=JSON.stringify(a);localStorage.setItem(e,i)},setStorSimple:function(e,t){var a=JSON.stringify(t);localStorage.setItem(e,a)},getStorage:function(e){if(!localStorage.getItem(e))return!1;var t=localStorage.getItem(e);return JSON.parse(t)},isFresh:function(e,t){var a=this.getStorage(e).createTime,i=t||864e5,n=(new Date).getTime();return n-a<i},setCookie:function(e,t){var a=e+"="+t,i=new Date;i.setHours(i.getHours()+1),a+="; expires="+i.toGMTString(),document.cookie=a},getCookie:function(e){var t=new RegExp("(^| )"+e+"=([^;]*)(;|$)"),a=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return t===document.cookie.match(a)?unescape(t[2]):null},delCookie:function(e){var t=new Date;t.setTime(t.getTime()-1);var a=Cookie.getCookie(e);null!=a&&(document.cookie=e+"="+a+";expires="+t.toGMTString())}};t.default=i},decd:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a("23f7"),n="/backend-api/service-confirm/un-bind-list",r="/backend-api/service-confirm/bind-list",s="/backend-api/service-confirm/video-relation",o="/backend-api/service-confirm/confirm-create",c=function(e){return i.axios.post(n,e)},l=function(e){return i.axios.post(r,e)},d=function(e){return i.axios.post(s,e)},u=function(e){return i.axios.post(o,e)},f={getUnBindList:c,getBindList:l,setVideoRelation:d,setConfirmSign:u},m=f;t.default=m},e246:function(e,t,a){"use strict";var i=a("8345"),n=a.n(i);n.a},f61d:function(e,t,a){var i=a("abd8");t=i(!1),t.push([e.i,".voucher-user-sign-copy-dom{font-size:.48rem;text-align:center}.voucher-user-sign-copy-dom .title{margin:.4rem 0}.voucher-user-sign-copy-dom>img{width:100%}.voucher-user-sign-copy-dom .user-name{overflow:hidden;padding:.266667rem .533333rem 0;background-color:#fff}.voucher-user-sign-copy-dom .user-name>span{font-size:.373333rem;float:left;line-height:1.253333rem}.voucher-user-sign-copy-dom .user-name>img{float:left;height:2.666667rem;-webkit-transform:rotate(-90deg);transform:rotate(-90deg);margin-top:-.72rem;margin-left:.533333rem}.voucher-user-sign-copy-dom .sign-time{padding:0 .533333rem;height:1.066667rem;line-height:.533333rem;font-size:.373333rem;text-align:right;background-color:#fff}",""]),e.exports=t}}]);